## FIFA 2018 Data Exploration and Visualization with R

### Table of Contents
- [Loading dataset](#load-data-and-libraries)
- **Ranking**
	- [Players and Euro values](#players-and-euro-values)
	- [Players and Overall rating]([#players-and-overall-rating)
	- [Club teams and Overall rating](#top-10-club-teams-and-overall-rating)
	- [Club teams and Potential rating](#top-10-club-teams-and-potential-rating)
- [Correlation matrix - Overall rating](#correlation-matrix)
- **Distributions**
	- [Age](#age)
	- [Overall](#overall)
	- [Height (cm)](#height)
	- [Weight (kg)](#weight)
- **[Data visualization: Part 1](#data-visualization-:-part-1)**
	- [Age vs Overall rating](#age-vs-overall)
	- [Club teams vs Euro values](#club-team-vs-euro-value)
- **[Data visualization: Part 2](#data-visualization:-part-2)**
	- [Nationality analysis from top 5 teams](#nationality-analysis-from-top-5-club-teams)
- [World map](#world-map)

### Load data and libraries
``` R
# Importing library
library(ggplot2)
library(corrplot)
library(dplyr)
library(data.table)
library(gridExtra)
library(treemapify)
library(ggplotify)
library(rworldmap)
library(ggmap)
```
``` R
# Importing data
fifa = read.csv("fifa.csv", stringsAsFactors = FALSE)
fifa = tbl_df(fifa)
str(fifa)
```
```
Classes ‘tbl_df’, ‘tbl’ and 'data.frame':	17994 obs. of  89 variables:
 $ ID                      : int  20801 158023 190871 176580 167495 188545 193080 183277 182521 167664 ...
 $ name                    : chr  "Cristiano Ronaldo" "L. Messi" "Neymar" "L. SuÃ¡rez" ...
 $ full_name               : chr  "C. Ronaldo dos Santos Aveiro" "Lionel Messi" "Neymar da Silva Santos Jr." "Luis SuÃ¡rez" ...
 $ club                    : chr  "Real Madrid CF" "FC Barcelona" "Paris Saint-Germain" "FC Barcelona" ...
 $ age                     : int  32 30 25 30 31 28 26 26 27 29 ...
 $ league                  : chr  "Spanish Primera DivisiÃ³n" "Spanish Primera DivisiÃ³n" "French Ligue 1" "Spanish Primera DivisiÃ³n" ...
 $ birth_date              : chr  "2/5/1985" "6/24/1987" "2/5/1992" "1/24/1987" ...
 $ height_cm               : int  185 170 175 182 193 185 193 173 182 184 ...
 $ weight_kg               : int  80 72 68 86 92 79 76 76 78 87 ...
 $ body_type               : chr  "C. Ronaldo" "Messi" "Neymar" "Normal" ...
 $ nationality             : chr  "Portugal" "Argentina" "Brazil" "Uruguay" ...
 $ eur_value               : int  95500000 105000000 123000000 97000000 61000000 92000000 64500000 90500000 79000000 77000000 ...
 $ eur_wage                : int  565000 565000 280000 510000 230000 355000 215000 295000 340000 275000 ...
 $ eur_release_clause      : int  195800000 215300000 236800000 198900000 100700000 151800000 124200000 174200000 162000000 127100000 ...
 $ overall                 : int  94 93 92 92 92 91 90 90 90 90 ...
 $ potential               : int  94 93 94 92 92 91 92 91 90 90 ...
 $ pac                     : int  90 89 92 82 91 81 90 90 56 79 ...
 $ sho                     : int  93 90 84 90 90 88 85 82 81 87 ...
 $ pas                     : int  82 86 79 79 95 75 87 84 89 70 ...
 $ dri                     : int  90 96 95 87 89 86 90 92 81 83 ...
 $ def                     : int  33 26 30 42 60 38 58 32 73 25 ...
 $ phy                     : int  80 61 60 81 91 82 86 66 70 74 ...
 $ international_reputation: int  5 5 5 5 5 4 4 4 4 4 ...
 $ skill_moves             : int  5 4 5 4 1 3 1 4 3 3 ...
 $ weak_foot               : int  4 4 5 4 4 4 3 4 5 4 ...
 $ work_rate_att           : chr  "High" "Medium" "High" "High" ...
 $ work_rate_def           : chr  "Low" "Medium" "Medium" "Medium" ...
 $ preferred_foot          : chr  "Right" "Left" "Right" "Right" ...
 $ crossing                : int  85 77 75 77 15 62 17 80 85 68 ...
 $ finishing               : int  94 95 89 94 13 91 13 83 76 91 ...
 $ heading_accuracy        : int  88 71 62 77 25 85 21 57 54 86 ...
 $ short_passing           : int  83 88 81 83 55 83 50 86 90 75 ...
 $ volleys                 : int  88 85 83 88 11 87 13 79 82 88 ...
 $ dribbling               : int  91 97 96 86 30 85 18 93 79 84 ...
 $ curve                   : int  81 89 81 86 14 77 21 82 85 74 ...
 $ free_kick_accuracy      : int  76 90 84 84 11 84 19 79 84 62 ...
 $ long_passing            : int  77 87 75 64 59 65 51 81 93 59 ...
 $ ball_control            : int  93 95 95 91 48 89 42 92 89 85 ...
 $ acceleration            : int  89 92 94 88 58 79 57 93 60 78 ...
 $ sprint_speed            : int  91 87 90 77 61 83 58 87 52 80 ...
 $ agility                 : int  89 90 96 86 52 78 60 93 71 75 ...
 $ reactions               : int  96 95 88 93 85 91 88 85 86 88 ...
 $ balance                 : int  63 95 82 60 35 80 43 91 69 69 ...
 $ shot_power              : int  94 85 80 87 25 88 31 79 87 88 ...
 $ jumping                 : int  95 68 61 69 78 84 67 59 32 79 ...
 $ stamina                 : int  92 73 78 89 44 79 40 79 77 72 ...
 $ strength                : int  80 59 53 80 83 84 64 65 74 85 ...
 $ long_shots              : int  92 88 77 86 16 83 12 82 90 82 ...
 $ aggression              : int  63 48 56 78 29 80 38 54 60 50 ...
 $ interceptions           : int  29 22 36 41 30 39 30 41 85 20 ...
 $ positioning             : int  95 93 90 92 12 91 12 85 79 92 ...
 $ vision                  : int  85 90 80 84 70 78 68 86 88 70 ...
 $ penalties               : int  85 78 81 85 47 84 40 86 73 70 ...
 $ composure               : int  95 96 92 83 70 87 64 87 85 86 ...
 $ marking                 : int  22 13 21 30 10 25 13 25 63 12 ...
 $ standing_tackle         : int  31 28 24 45 10 42 21 27 82 22 ...
 $ sliding_tackle          : int  23 26 33 38 11 19 13 22 69 18 ...
 $ gk_diving               : int  7 6 9 27 91 15 90 11 10 5 ...
 $ gk_handling             : int  11 11 9 25 90 6 85 12 11 12 ...
 $ gk_kicking              : int  15 15 15 31 95 12 87 6 13 7 ...
 $ gk_positioning          : int  14 14 15 33 91 8 86 8 7 5 ...
 $ gk_reflexes             : int  11 8 11 37 89 10 90 8 10 10 ...
 $ rs                      : int  92 88 84 88 NA 88 NA 82 77 87 ...
 $ rw                      : int  91 91 89 87 NA 84 NA 88 80 82 ...
 $ rf                      : int  91 92 88 88 NA 87 NA 87 81 84 ...
 $ ram                     : int  89 92 88 87 NA 84 NA 88 83 81 ...
 $ rcm                     : int  82 84 79 80 NA 78 NA 81 87 71 ...
 $ rm                      : int  89 90 87 85 NA 82 NA 87 81 79 ...
 $ rdm                     : int  62 59 59 65 NA 62 NA 61 82 52 ...
 $ rcb                     : int  53 45 46 58 NA 57 NA 47 72 46 ...
 $ rb                      : int  61 57 59 64 NA 58 NA 59 76 51 ...
 $ rwb                     : int  66 62 64 68 NA 61 NA 64 78 55 ...
 $ st                      : int  92 88 84 88 NA 88 NA 82 77 87 ...
 $ lw                      : int  91 91 89 87 NA 84 NA 88 80 82 ...
 $ cf                      : int  91 92 88 88 NA 87 NA 87 81 84 ...
 $ cam                     : int  89 92 88 87 NA 84 NA 88 83 81 ...
 $ cm                      : int  82 84 79 80 NA 78 NA 81 87 71 ...
 $ lm                      : int  89 90 87 85 NA 82 NA 87 81 79 ...
 $ cdm                     : int  62 59 59 65 NA 62 NA 61 82 52 ...
 $ cb                      : int  53 45 46 58 NA 57 NA 47 72 46 ...
 $ lb                      : int  61 57 59 64 NA 58 NA 59 76 51 ...
 $ lwb                     : int  66 62 64 68 NA 61 NA 64 78 55 ...
 $ ls                      : int  92 88 84 88 NA 88 NA 82 77 87 ...
 $ lf                      : int  91 92 88 88 NA 87 NA 87 81 84 ...
 $ lam                     : int  89 92 88 87 NA 84 NA 88 83 81 ...
 $ lcm                     : int  82 84 79 80 NA 78 NA 81 87 71 ...
 $ ldm                     : int  62 59 59 65 NA 62 NA 61 82 52 ...
 $ lcb                     : int  53 45 46 58 NA 57 NA 47 72 46 ...
 $ gk                      : int  NA NA NA NA 92 NA 90 NA NA NA ...
```
### Ranking

#### Players and Euro values
``` R
fifa %>% select(name, club, eur_value) %>% arrange(desc(eur_value)) %>% head(10) %>% data.table()
```
![player vs value](https://user-images.githubusercontent.com/38479244/41644841-204e5492-7424-11e8-8ce0-da247113f760.jpg)

#### Players and Overall rating
``` R
fifa %>% select(name, club, overall) %>% arrange(desc(overall)) %>% head(10) %>% data.table()
```
![player vs overall](https://user-images.githubusercontent.com/38479244/41644819-11a83912-7424-11e8-9c63-7dce9d18d1ef.jpg)

#### Top 10 club teams and Overall rating
``` R
club_overall = fifa %>% select(club, league, overall) %>% group_by(club) %>% summarise(Overall = mean(overall)) %>% arrange(desc(Overall)) %>% head(10) %>% data.table()
```
![team vs overall](https://user-images.githubusercontent.com/38479244/41644820-11d6fa22-7424-11e8-8268-032e03eff4f3.jpg)

#### Top 10 club teams and Potential rating
``` R
fifa %>% select(club, league, potential) %>% group_by(club) %>% summarise(Potential = mean(potential)) %>% 
arrange(desc(Potential)) %>% head(10) %>% data.table()
```
![team vs potential](https://user-images.githubusercontent.com/38479244/41644762-e6c38dc8-7423-11e8-894f-9f918e697613.jpg)


### Correlation Matrix
``` R
  numvar = which(sapply(fifa, is.numeric))
  numvar = fifa[, numvar]
  corr = cor(numvar, use = "pairwise.complete.obs")
  corr_sorted = as.matrix(sort(corr[, 'overall']), decreasing = TRUE)
  corr_sorted = names(which(apply(corr_sorted, 1, function(x) abs(x)>0.6)))
  corr_final = corr[corr_sorted, corr_sorted]
  corr_final = corr_final[-29, -29]
  corrplot.mixed(corr_final, tl.col = 'black', number.cex = 0.70, tl.pos = 'lt')
```
![correlation matrix](https://user-images.githubusercontent.com/38479244/41644953-7302402c-7424-11e8-98d3-a23d184f1b64.png)

### Distributions

#### Age
``` R
  ggplot(fifa, aes(x = age))+
    geom_histogram(aes(y = ..density..), binwidth = 2, color = "dark grey", fill = "white")+
    geom_density(alpha = .2, fill = "steelblue", size = 0.9)
```
![age distr](https://user-images.githubusercontent.com/38479244/41645413-cdd04746-7425-11e8-8fa3-c3bd5dc4b3e6.png)
#### Overall
``` R
  ggplot(fifa, aes(x = overall))+
    geom_histogram(aes(y = ..density..), binwidth = 2, color = "dark grey", fill = "white")+
    geom_density(alpha = .2, fill = "steelblue", size = 0.9)
```
![overall distr](https://user-images.githubusercontent.com/38479244/41645412-cdb5a486-7425-11e8-8394-39028dfea786.png)
#### Height
``` R
  ggplot(fifa, aes(x = height_cm))+
    geom_histogram(aes(y = ..density..), alpha=0.5, binwidth = 3, color = "dark grey", fill = "white")
```
![height distr](https://user-images.githubusercontent.com/38479244/41645410-cd983c66-7425-11e8-9c7a-349f641a32a0.png)
#### Weight
``` R
  ggplot(fifa, aes(x = weight_kg))+
    geom_histogram(aes(y = ..density..), alpha=0.5, binwidth = 3, color = "dark grey", fill = "white")
```
![weight distr](https://user-images.githubusercontent.com/38479244/41645414-cdeae146-7425-11e8-8ebe-73f6ef1696e0.png)


### Data visualization: Part 1

#### Age vs Overall
``` R
  age = fifa %>% filter(age<40)  %>% select(age, overall) %>% group_by(age) %>% 
    summarize(Overall = mean(overall))
  
  ggplot(age, aes(x = age, y = Overall))+
    geom_line(color = 'red', size = 1.5)+
    geom_vline(color = 'blue', xintercept = 30, linetype = "dashed")+
    labs(title = "Age vs Overall", 
         x = "Age",
         y = "Overall")
```
![age vs overall part1 vis](https://user-images.githubusercontent.com/38479244/41645893-2c3e349a-7427-11e8-8014-13d118b42a25.png)

#### Club team vs Euro value
``` R
  club.value = fifa %>% select(club, eur_value) %>% group_by(club) %>% summarize(Value = mean(eur_value)) %>% 
    arrange(desc(Value)) %>% head(10)
  
  ggplot(fifa %>% filter(club %in% club.value$club), aes(x = reorder(club, eur_value), y = eur_value))+
    geom_boxplot(color = "purple", outlier.colour = "red")+
    scale_y_continuous(breaks = seq(0, 125000000, by = 10000000))+
    labs(title = "Club Team vs Euro Value", 
         x = "Club Team",
         y = "Euro Value")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
![club team vs value part1 vis](https://user-images.githubusercontent.com/38479244/41645892-2c1f15d8-7427-11e8-8522-5721047da697.png)

### Data visualization: Part 2

#### Nationality analysis from top 5 club teams
 ``` R
 Top_5 = fifa %>% select(club, eur_value, overall) %>% group_by(club) %>% 
 summarize(Value = mean(eur_value), Avg_Overall = mean(overall)) %>% 
 arrange(desc(Value)) %>% head(5)
    
 Top_teams = fifa %>% filter(club %in% Top_5$club) %>% group_by(club, nationality) %>% 
 summarise(num_nationality = n(), Sub_overall = mean(overall))
  
 Top_teams = merge(Top_teams, club_overall)
  
 ggplot(Top_teams, aes(area = Overall, fill = num_nationality, label = nationality, subgroup = club))+
    geom_treemap()+
    geom_treemap_text(colour = "white", 
                      alpha = 0.75, 
                      place = "middle")+
    geom_treemap_subgroup_text(colour = "black", 
                               grow = T, 
                               fontface = 'italic', 
                               min.size = 0, 
                               place = "middle",
                               alpha = 0.55)+
    facet_wrap(~club)+
    theme(legend.position = "bottom")+
    labs(title = "Nationality from Top 5 Teams", 
         fill = "# of Nationality",
         caption = "The area of each tile represents the mean of nationality's overall rating as a proportion of 
         all nationalities in that team")+
    scale_fill_gradient(low = "antiquewhite4", high = "dark red")
 ```
 
![treemap](https://user-images.githubusercontent.com/38479244/41645977-734af40e-7427-11e8-9c5a-68cfc7d4d0b4.png)

### World map
``` R
  # Create a data frame that you would like to map countries for
  countries = fifa %>% select(nationality) %>% group_by(nationality) %>% summarise(count = n())
  countries$nationality[countries$nationality %in% c('England', 'Wales')] = "Great Britain"
  countries$nationality[countries$nationality %in% c('ChinaPR', 'Hong Kong')] = "China"
  countries$nationality[countries$nationality == 'Korea DPR'] = 'North Korea'
  countries$nationality[countries$nationality == 'Korea Republic'] = 'South Korea'
 
  # Join data to a map
  countries_points = joinCountryData2Map(countries, joinCode = "NAME", nameJoinColumn = "nationality")
  
  # Display the map
  mapCountryData(mapToPlot = countries_points, 
                 nameColumnToPlot = "count", 
                 oceanCol = "lightblue",
                 missingCountryCol = "white",
                 mapTitle = 'Origin of Nationality',
                 catMethod = "fixedWidth"
                 )
```
![worldmap](https://user-images.githubusercontent.com/38479244/41646070-b6d35054-7427-11e8-8d4b-b60bb2a39533.png)
